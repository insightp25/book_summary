# 3. 테스트코드 작성 순서

# 테스트 코드 작성 순서

- 쉬운 경우에서 어려운 경우로 진행
- 예외적인 경우에서 정상인 경우로 진행

한 번에 완벽한 코드를 만들면 좋겠지만, 모두가 수퍼 개발자인 것은 아니다.  
보통의 개발자는 한 번에 많은 코드를 만들다 보면 나도 모르게 버그를 만들고 -> 나중에 버그를 잡기 위해 많은 시간 허비  
코드 작성 기간 길어지면 -> 집중력 저하 -> 휴식 등 흐름 끊김 -> 복귀후 다시 흐름 이어가려면 시간 필요  


## 구현하기 쉬운 테스트부터 시작하기 

하나의 테스트 통과시 그 다음으로 구현하기 쉬운 테스트 선택  
보통 수 분 내에 구현을 완료하고 통과시킬 수 있는 테스트를 선택  
점진적으로 구현  



<br><br>

## 예외 상황을 먼저 테스트해야 하는 이유

예외 상황 고려하지 않은 코드에 예외 상황 반영 -> 코드 구조 뒤집거나 중간에 예외 상황 처리 조건문 중복 추가하는 일 발생 -> 코드 복잡도 상승, 버그 발생 가능성 증가  
TDD를 하는 동안 예외 상황을 찾고 테스트에 반영 -> NPE 등 예외 상황 버그 감소  



<br><br>

## 완급 조절

1. 정해진 값을 리턴
2. 값 비교를 이용해 정해진 값 리턴
3. 다양한 테스트를 추가하면서 구현을 일반화

'테스트-구현-확인'의 리듬  

TDD가 익숙해지면 상황에 따라 구현 속도 조절이 가능해진다.  
단순 덧셈이나 길이 비교와 같은 명백한 구현은 바로 구현 -> 잘 안되면 한 발 물러서서 천천히 단계 밟아 나가면 된다.  



<br><br>

## 지속적인 리팩토링

테스트 통과후 -> 리팩토링 진행  

소프트웨어 생존 시간이 길어질수록 지속적으로 개선해야  
잘 변경하려면 변경하기 쉬운 구조를 가져야 한다 -> 소프트웨어의 생존 시간을 늘려준다.  

마틴 파울러 - '리팩토링'(1판 자바, 2판 자바스크립트) 참고  

- 변수 네이밍, 상수 <-> 변수 변경 등 간단한 리팩토링은 바로 실행  
- 메서드 추출 등 메서드 구조에 영향을 주는 리팩토링 -> 큰 틀에서 구현 흐름이 눈에 들어오기 시작한 뒤에 진행  
  - 구현 초기에는 아직 구현의 전반적 흐름을 모른다 -> 리팩토링시 코드 구조를 잘못 잡을 가능성





<br><br><br>

# 테스트 작성 순서 연습

구독 만료일 계산기

## 코드 정리: 중복 제거

파라미터가 많으면 객체 형태로 바꿔서 파라미터를 한 개로 만드는 방안 존재  

각 테스트 메서드는 스스로 무엇을 테스트하는지 명확하게 설명할 수 있어야 -> 테스트 코드의 중복제거는 고민이 필요  





<br><br>

## 다음 테스트 추가 전 리팩토링

파라미터 개수는 적을수록 코드 가독성과 유지보수에 유리  
메서드 파라미터 개수가 세 개 이상이면 객체로 바꿔 한 개로 줄이는 것을 고려해야  





<br><br>

## 테스트할 목록 정리하기

TDD 시작시 테스트할 목록을 미리 정리하면 좋다.  

eg. 만료일 계산 기능 구현시:  

- 1만 원 납부시 한 달 뒤 만료
- 달의 마지막 날에 납부시 다음달 마지막 날 만료
- 2만 원 납부시 2개월 뒤 만료
- 3만원 납부시 3개월 뒤 만료
- 10만원 납부시 1년 뒤 만료

정리 후 어떤 테스트가 구현이 쉬울지 또는 예외적인지 상상해본다.  
테스트 과정에서 새로운 테스트 사례 발견시 그 사례를 목록에 추가해 놓치지 않도록 한다. 처음부터 모든 사례를 정리하려면 시간도 오래 걸리고 쉽지도 않다! 개발을 진행하다 보면 생각지도 못한 테스트 사례를 발견하기 마련.

'지라'나 '트렐로' 등 시스템 사용시 해당 테스트 사례를 하위 작업으로 등록, 통과 여부 추적 가능.  

테스트를 한 번에 다 작성하면 안 된다. 코드가 많으면 리팩토링도 어려워진다.

'테스트 코드 -> 통과 -> 리팩토링'의 짧은 리듬 반복. 범위가 작고 개발 주기도 짧아 집중력도 높아진다.

범위가 큰 리팩토링 거리 발견할 때도 있다. 이 땐 리팩토링은 다음 할 일 목록에 추가해서 놓치지 않고 진행하고, 당장은 진행보다 테스트를 통과시키는 데 집중.



<br><br>
