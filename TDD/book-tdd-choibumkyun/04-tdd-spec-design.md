# 4. TDD, 기능 명세, 설계

# 기능 명세

기능은 크게 두 가지로 나누어 생각해 볼 수 있다. 입력과 결과.  
기능 실행 결과에는 예외나 변경도 포함한다.

DB에 데이터를 추가하는 것은 값 리턴과 달리 시스템의 상태를 변경 -> 리턴 값으로는 결과를 알 수 없기 때문에 테스트 대상 실행 뒤, 변경 대상에 접근해 결과를 확인. 결과는 상황에 따라 달라질 수 있다(저장/실패).

설계는 기능 명세로부터 시작한다. 스토리보드 등 다양한 형태의 요구사항 문서를 이용해 기능 명세를 구체화한다. 기능 명세 구체화 과정중 입력, 결과를 도출하고 기능 명세를 코드에 반영한다. 이 과정에서 기능의 이름, 파라미터, 리턴 타입 등이 결정된다. 이는 곧 기능에 대한 설계 과정과 연결(!)된다.




<br><br>

# 설계 과정을 지원하는 TDD

- 클래스 이름
- 메서드 이름
- 메서드 파라미터
- 실행 결과

이 네 가지를 결정하는 과정에서 이름을 고민하고 파라미터 타입과 리턴 타입을 고민했다. 이는 곧 설계 행위이다. TDD에서 테스트 코드 작성할 때 고민하는 것과 설계 과정에서 고민하는 것은 겹친다. 즉, TDD를 하다보면 일부 설계를 진행하게 된다.

> 이름은 설계에서 매우 중요. 구현 기능을 정확히 표현하는 것 만큼 중요한 것은 없다. 이름과 다르게 동작하는 코드는 개발자를 속일 뿐만 아니라, 코드 분석 시간을 증가시켜 유지보수를 어렵게 만드는 원인이 된다.  
테스트 코드는 시작부터 이름을 고민하게 만든다. 시간이 다소 걸려도 이름을 고민하는 시간을 아까워하지 말아야 한다.




<br><br>

## 필요한 만큼 설계하기

TDD는 테스트를 통과할 만큼만 코드를 작성한다. 필요를 미리 예측해서 코드를 만들지 않는다. -> 설계에서도 동일하다. 필요를 미리 예측해서 설계를 유연하게 만들지 않는다.  

기능 실행 결과도 동일하다(?). 미리 앞서 필요해 보이는 예외 타입을 만들지 않는다. 테스트 진행중 실제 예외가 필요한 시점에 예외를 도출한다.  
`TDD로 개발하는 코드 비율이 높아질수록 지금 시점에서 필요한 설계만 코드에 반영할 가능성이 커진다`. 유연한 설계는 필요한 시점에 추가하며, 이는 설계가 불필요하게 복잡해지는 것을 방지할 수 있다.  

TDD를 한다고 설계를 생략하는 것은 아니다. 요구사항 분석중 당연히 설계를 한다. 다만 요구사항이 바뀌므로 설계 요소가 구현 과정에서 쓸모가 없어지기도, 반대로 나중에 설계 요소가 출현하기도 한다. TDD는 미리 앞서 코드를 만들지 않으므로 불필요한 구성 요소를 덜 만들게 된다.



<br><br>

# 기능 명세 구체화

기능 명세 정리 -> 테스트 코드 작성.  
보통 개발자는 기획자가 작성한 스토리보드, 와이어프레임 같은 형태로 요구사항 명세를 전달받는다. 이런 문서는 기능 구현하기엔 생략된 내용이 많다.

테스트 코드 작성시 입력, 결과가 명확해야 하므로 애매한 점 발견시 기획자, 실무 담당자와 논의, 구체적으로 정리해야 한다. 테스트 코드는 구체적 입력과 결과를 요하므로 개발자는 `예를 통해` 기능 명세를 구체화하게 된다.

모호한 상황을 만나면 구체적 예로 바꾸어 테스트 코드에 반영한다. 즉 `테스트 코드는 예를 이용한 구체적인 명세가 된다`.

또한, 테스트 코드는 바로 실행할 수 있어 예를 이용해 기능을 바로 실행해볼 수 있다. 이는 유지보수에 큰 도움이 된다.

특정 상황에서 코드가 어떻게 동작하는지 이해하고 싶다면 해당 상황을 검증하는 테스트를 실행하고 이해가 필요한 코드를 추적하면 된다.

`복잡한 로직을 구현해야 하는 것은 결국 개발자이므로 개발자는 최대한 예외적인 상황이나 복잡한 상황에 해당하는 구체적인 예를 끄집어내야 한다`. 가장 좋은 방법은 담당자와 대화를 하는 것이다. 대화과정이 쉽지 않을 때도 있지만 대화를 하지 않으면 올바른 결과물을 개발하지 못한다.


<br><br>