# 4. 테스트 코드의 구성

# 기능에서의 상황

기능은 주어진 상황에 따라 다르게 동작하고 실행 결과가 달라진다. 이는 테스트 코드 구조에도 영향을 준다.

> 노련한 개발자는 어떤 상황이 실행 결과에 영향을 줄 수 있는지 찾기 위해 노력한다. 상황을 고려하지 않고 작성한 코드는 버그를 포함할 가능성이 크다...결과에 영향을 줄 수 있는 가능한 많은 예외 상황을 찾기 위해 노력해야 한다. 그렇게 소프트웨어의 품질을 높일 수 있다.



<br><br>

# 테스트 코드의 구성 요소: 상황, 실행, 결과 확인

>> 상황given, 실행when, 결과then


```java
// 야구 게임 예
@Test
void exactMatch() {
	// 정답이 456인 '상황'
	BaseballGame game = new BaseballGame("456");

	// '실행'
	Score score = game.guess("456");

	// 결과 '확인'
	assertEquals(3, score.strikes());
	assertEquals(0, score.balls());
}
```

상황이 없는 경우도 존재.  
eg. 2장의 암호 강도 측정의 경우 결과에 영향을 주는 상황이 존재하지 않으므로 실행과 결과 확인만 포함하게 된다.  

실행 결과는 리턴 값 사용, 익셉션을 발생하는 것 등이 있다.

상황-실행-결과 확인 구조에 집착할 필요는 없고, 테스트 코드를 보고 테스트 내용을 이해할 수 있으면 된다.




<br><br>

## 외부 상황과 외부 결과

eg. 외부 파일 읽어와 수행하는 기능

테스트는 실행할 때마다 동일 결과를 보장해야 한다. 그렇지 않은 경우 테스트를 신뢰하지 못해 테스트 결과를 무시하게 만드는 요인이 된다.


note: java `...` 문법

```java
{
	// 생략
	givenDataFile("target/datafile.txt", "1", "2", "3", "4");
	// 생략
}

private void givenDataFile(String path, String... lines) { // 이곳
	// 생략
	Files.write(dataPath, Arrays.asList(lines));
	// 생략
}
```





<br><br>

## 외부 상태가 테스트 결과에 영향을 주지 않게 하기

테스트는 언제 실행해도 항상 정상적으로 동작하는 것이 중요하다.  

eg. 회원가입 기능. DB 데이터의 상태에 따라 테스트가 성공하기도, 실패하기도 한다. 예를 들어 회원가입 성공후 해당 id를 DB에서 삭제해놓거나 트랜잭션을 롤백해야 한다.




<br><br>

## 외부 상태와 테스트 어려움

외부 요인은 DBMS, 외부 서버 등 다양하다.

eg. 자동이체 등록 기능. 금융 회사 제공 REST API를 사용한다면 -> 테스트는 다음 상황에서의 결과를 확인해야 할 수 있어야 한다.

* 외부 API 서버에 연결할 수 없는 상황
* 외부 API 서버에서 응답을 5초 이내에 받지 못하는 상황

서버를 죽여 달라고 할 수도, 응답을 7초뒤에 주도록 수정해 달라고 할 수도 없다.  

실행 결과가 외부 시스템에 기록되는 경우도 있다.

eg. 택배사가 자사 DB 테이블에 insert와 select 권한을 주고 접근할 수 있도록 한 경우. delete는 불허.

이렇게 테스트 대상의 상황과 결과에 외부 요인이 관여할 경우 대역을 사용하면 테스트 작성이 쉬워진다(다음장에서 계속).

<br><br>

