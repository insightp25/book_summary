# 섹션4. 실습 - 구조적 변화를 주는 테스트 코드

# 패키지 구조 개선

- 도메인별로 패키지 분리
  - 주의할 점: 패키지간 순환 참조!!
    





<br><br>


# 서비스를 소형 테스트로 만들기

- 소형 테스트는 단일 스레드에서 돌아가기 때문에 병렬처리와 동기화를 걱정할 필요가 없다 -> `UserRepositoryTest` 리팩토링에서 `AtomicLong`, `Collections.synchronizedList()` 등 사용 불필요


- Jpa 동작 원리 중 하나가 Id 값이 null이거나 0이면 insert, 그렇지 않으면 update -> fake에 유사하게 구현
    - 코드 예시
    ```java
    if (user.getId() == 0 || user.getId() == null) {
        User newUser = User.builder()
                .id(++autoGeneratedId)
                .email(user.getEmail())
                .nickname(user.getNickname())
                .address(user.getAddress())
                .certificationCode(user.getCertificationCode())
                .status(user.getStatus())
                .lastLoginAt(user.getLastLoginAt())
                .build();
        data.add(newUser);
        return newUser;
    } else {
        data.removeIf(item -> Objects.equals(item.getId(), user.getId()));
        data.add(user);
        return user;
    }
    ```



- 서비스 테스트를 소형 테스트로 만드는 작업 완료
    - 속도 대폭 향상
    - h2나 mockito 없이도 테스트가 가능하도록 리팩토링
      - -> 굳이 자바가 아니라 다른 언어에 가서도 이 원리를 이용해 테스트 라이브러리 없이도 테스트 가능




<br><br>


## 
    







<br>


## 
    










<br><br>

---

# 

## 
    







<br>


## 
    







<br>


## 
    







<br>


## 
    










<br><br>

---

# 

## 
    







<br>


## 
    







<br>


## 
    







<br>


## 
    










<br><br>

---

# 

## 
    







<br>


## 
    







<br>


## 
    







<br>


## 
    










<br><br>

---

# 

## 
    







<br>


## 
    







<br>


## 
    







<br>


## 
    










<br><br>

---

# 

## 
    







<br>


## 
    







<br>


## 
    







<br>


## 
    










<br><br>

---